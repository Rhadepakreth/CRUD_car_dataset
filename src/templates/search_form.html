{% extends "base.html" %}

{% block title %}Rechercher des Voitures{% endblock %}

{% block content %}
    <h1>Rechercher des Voitures</h1>
    <form method="POST" action="{{ url_for('search_cars_route') }}">
        <div class="form-group">
            <label for="attribute">Rechercher par Attribut :</label>
            <select class="form-control" id="attribute" name="attribute" onchange="updateValueInput()">
                {% for attr in possible_attributes %}
                    <option value="{{ attr }}">{{ attr.replace('_', ' ').capitalize() }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group" id="value-container">
            <label for="value">Valeur :</label>
            <input type="text" class="form-control" id="value" name="value" required>
        </div>

        <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Rechercher</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary"><i class="fas fa-times"></i> Annuler</a>
    </form>

    <script>
        const fieldsConfig = {
            'fuel': ['Petrol', 'Diesel', 'CNG', 'LPG', 'Electric'],
            'seller_type': ['Individual', 'Dealer', 'Trustmark Dealer'],
            'transmission': ['Manual', 'Automatic'],
            'owner': ['First Owner', 'Second Owner', 'Third Owner', 'Fourth & Above Owner', 'Test Drive Car']
        };

        function updateValueInput() {
            const attribute = document.getElementById('attribute').value;
            const container = document.getElementById('value-container');
            
            if (fieldsConfig[attribute]) {
                let html = `<label for="value">Valeur :</label>
                            <select class="form-control" id="value" name="value" required>
                                <option value="">-- SÃ©lectionner --</option>`;
                
                fieldsConfig[attribute].forEach(option => {
                    html += `<option value="${option}">${option}</option>`;
                });
                
                html += '</select>';
                container.innerHTML = html;
            } else {
                container.innerHTML = `
                    <label for="value">Valeur :</label>
                    <input type="text" class="form-control" id="value" name="value" required>
                `;
            }
        }

        // Initialiser au chargement
        document.addEventListener('DOMContentLoaded', updateValueInput);
    </script>
{% endblock %}